# Commands and scripts used to generate the 8 genera phylogenetic tree (Fig 1E)

#Removes sequences that are less than 100aa in length
python rm_100aa.py

#Clusters redundant sequences
cd-hit -i all_effector_wchap_genus_more100aa.fasta -o all_effector_wchap_genus_more100aa_CDHIT95.fasta -c 0.95 -n 5 -S 50

#Find PAAR motif

hmmsearch --domtblout all_effector_wchap_genus_more100aa_CDHIT95_shortheaders_PAAR_1.domtblout --noali -Z 45638612 -E 1000 --cpu 32 -o all_effector_wchap_genus_more100aa_CDHIT95_shortheaders_PAAR_1.out PAAR_motif.hmm all_effector_wchap_genus_more100aa_CDHIT95_shortheaders.fasta

python domsearch.py

hmmsearch --domtblout all_effector_wchap_genus_more100aa_CDHIT95_shortheaders_PAAR_2.domtblout --noali -Z 45638612 -E 1000 --cpu 32 -o all_effector_wchap_genus_more100aa_CDHIT95_shortheaders_PAAR_2.out 569D480A-C535-11EA-8CA8-D460F75AEC3D.3.hmm all_effector_wchap_genus_more100aa_CDHIT95_shortheaders_NOPAAR_1.fasta

python domsearch.py

hmmsearch --domtblout all_effector_wchap_genus_more100aa_CDHIT95_shortheaders_PAAR_3.domtblout --noali -Z 45638612 -E 1000 --cpu 32 -o all_effector_wchap_genus_more100aa_CDHIT95_shortheaders_PAAR_3.out 3FA0549C-CB54-11EA-9033-8FD5DBC3747A.2.hmm all_effector_wchap_genus_more100aa_CDHIT95_shortheaders_NOPAAR_2.fasta

python domsearch.py

hmmsearch --domtblout all_effector_wchap_genus_more100aa_CDHIT95_shortheaders_PAAR_4.domtblout --noali -Z 45638612 -E 1000 --cpu 32 -o all_effector_wchap_genus_more100aa_CDHIT95_shortheaders_PAAR_4.out 6A6151C8-CB7B-11EA-9FAA-814CE976C163.3.hmm all_effector_wchap_genus_more100aa_CDHIT95_shortheaders_NOPAAR_3.fasta

#Find transmembrane domain regions

http://www.cbs.dtu.dk/services/TMHMM/ -> tmhmm_result.txt

python tmhmm.py

http://phobius.sbc.su.se/ -> phobius_result.txt

python phobius.py

https://embnet.vital-it.ch/software/TMPRED_form.html - manually checking all remaining sequences 

all_effector_wchap_genus_more100aa_CDHIT95_TM.fasta - all sequences with annotated number of transmembrane domain regions

# Add prominent, previously published reference sequences

EFFECTORSEQ_REFERENCES.fasta - all reference sequences

all_effector_wchap_genus_more100aa_CDHIT95_TM_ref.fasta - all reference sequences + previously curated sequences

# Multiple sequence alignment 

mafft --auto all_effector_wchap_genus_more100aa_CDHIT95_TM_ref.fasta > all_effector_wchap_genus_more100aa_CDHIT95_TM_ref_mafft.fasta

trimal -in all_effector_wchap_genus_more100aa_CDHIT95_TM_ref_mafft.fasta -out all_effector_wchap_genus_more100aa_CDHIT95_TM_ref_mafft_trim.fasta -gt 0.8 -cons 80

fasttree -gamma all_effector_wchap_genus_more100aa_CDHIT95_TM_ref_mafft_trim.fasta > all_effector_wchap_genus_more100aa_CDHIT95_TM_ref_mafft_trim_tree

# Using R to make the tree

library("ggtree")
library("ggplot2")

tree <- read.tree("/Users/karatsang/Desktop/SherisProjects/EagProject/effectortree/kara_redundancy/all_effector_wchap_genus_more100aa_CDHIT95_TM_ref_mafft_trim_tree")
p <- ggtree(tree, layout="circular", branch.length='none') 

d = fortify(tree)
d = subset(d, isTip)
cat(with(d, label[order(y)]), file="all_effector_wchap_genus_more100aa_CDHIT95_TM_ref_mafft_trim_tree_tips.txt")

tip_cat=read.csv("/Users/karatsang/Desktop/SherisProjects/EagProject/effectortree/kara_redundancy/all_effector_wchap_genus_more100aa_CDHIT95_TM_ref_mafft_trim_tree_tips_effcat.tsv", sep = "\t", col.names=c("seq","cat"),  header = FALSE, stringsAsFactors = FALSE)
dd = as.data.frame(tip_cat)
p <- p %<+% dd + geom_tippoint(aes(colour = factor(cat)), size=0.5) +geom_treescale(width=3, color='red')

svg("all_effector_wchap_genus_more100aa_CDHIT95_TM_ref_mafft_trim_tree_tips_effcat.svg")
plot(p)
dev.off()


# Genera Tree

library("ggtree")
library("ggplot2")

tree <- read.tree("/Users/karatsang/Desktop/SherisProjects/EagProject/effectortree/kara_redundancy/all_effector_wchap_genus_more100aa_CDHIT95_TM_ref_mafft_trim_tree")
p <- ggtree(tree, layout="circular", branch.length='none') 

tip_cat=read.csv("/Users/karatsang/Desktop/SherisProjects/EagProject/effectortree/kara_redundancy/all_effector_wchap_genus_more100aa_CDHIT95_TM_ref_mafft_trim_tree_tips_genera.tsv", sep = "\t", col.names=c("seq","cat"),  header = FALSE, stringsAsFactors = FALSE)
dd = as.data.frame(tip_cat)
p <- p %<+% dd + geom_tippoint(aes(colour = factor(cat)), size=0.5) +geom_treescale(width=3, color='red')

svg("all_effector_wchap_genus_more100aa_CDHIT95_TM_ref_mafft_trim_tree_tips_genus.svg")
plot(p)
dev.off()


